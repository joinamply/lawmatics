<script>
    window.Webflow ||= [];
    window.Webflow.push(() => {
        // Register GSAP counter effect
        gsap.registerEffect({
            name: "counter",
            extendTimeline: true,
            defaults: {
                end: 0,
                duration: 1,
                separator: ",",
                ease: "power2",
                increment: 1,
            },
            effect: (targets, config) => {
                let tl = gsap.timeline()
                let num = targets[0].innerText.replace(/\,/g, '')
                targets[0].innerText = num

                tl.to(targets, {
                    duration: config.duration,
                    innerText: config.end,
                    modifiers: {
                        innerText: function (innerText) {
                            // For the final value, return the exact end value
                            if (Math.abs(innerText - config.end) < config.increment) {
                                return config.end.toString().replace(/\B(?=(\d{3})+(?!\d))/g, config.separator);
                            }
                            // Otherwise, snap to the nearest increment
                            return gsap.utils.snap(config.increment, innerText).toString().replace(/\B(?=(\d{3})+(?!\d))/g, config.separator);
                        }
                    },
                    ease: config.ease
                }, 0)

                return tl;
            }
        });

        // Initialize counters
        const $counters = $('[counter-wrapper="true"]');
        $counters.each(function () {
            const $number = $(this).find('[counter="number"]');
            const separator = $(this).attr('counter-separator') || ",";
            const increment = parseFloat($(this).attr('counter-increment')) || 1;
            const duration = parseFloat($(this).attr('counter-duration')) || 1;
            const endValue = parseFloat($number.text().replace(/[^0-9.\-]/g, '')) || 0;
            const delay = parseFloat($(this).attr('counter-delay')) || 0;

            // Set the number to 0 when page loads
            $number.text('0');

            // Use GSAP ScrollTrigger to animate the counter when its top reaches 90% of the viewport
            ScrollTrigger.create({
                trigger: this,
                start: "top 90%",
                once: true,
                onEnter: () => {
                    gsap.delayedCall(delay, () => {
                        gsap.effects.counter($number, {
                            end: endValue,
                            duration: duration,
                            separator: separator,
                            increment: increment
                        });
                    });
                }
            });
        });
    });
</script>